<ng-container *ngIf="employeesState$ | async as state" [ngSwitch]="state.dataState">
  <ng-container *ngSwitchCase="DataState.LOADED">
    <app-navbar [user]="state?.appData?.data?.user"></app-navbar>
    <section>
      <div class="container-fluid">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" style="margin-top: 8px">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a [routerLink]="['/']">Home</a>
            </li>
            <li class="breadcrumb-item active">Employees</li>
          </ol>
        </nav>

        <!-- Header Section -->
        <div class="row mt-3">
          <div class="col">
            <h4 class="fw-bold text-start">Employees</h4>
          </div>
          <div class="col">
            <h4 class="fw-bold text-end">
              <i
                style="cursor: pointer; color: green; font-size: 30px"
                class="bi bi-file-earmark-excel"
                title="Export to Excel"
              ></i>
            </h4>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="row mb-3">
          <div class="col-xm-12">
            <form
              #searchForm="ngForm"
              (ngSubmit)="searchEmployees(searchForm)"
              class="row g-3 float-end"
            >
              <div class="col-auto">
                <label for="name" class="visually-hidden">Search</label>
                <input
                  type="text"
                  ngModel
                  name="name"
                  #name
                  class="form-control"
                  placeholder="Search employees..."
                />
              </div>
              <div class="col-auto">
                <button type="submit" class="btn btn-primary mb-3">
                  <i class="bi bi-search"></i> Search
                </button>
              </div>
              <div class="col-auto">
                <button
                  type="button"
                  class="btn btn-success mb-3"
                  (click)="addNewEmployee()"
                >
                  <i class="bi bi-plus-circle"></i> Add Employee
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Employee Cards Grid -->
        <div class="row">
          <div
            class="col-lg-6 col-xl-4 mb-4"
            *ngFor="let employee of getEmployees(state)"
          >
            <div class="employee-card">
              <!-- Employee Header -->
              <div class="employee-header">
                <div class="employee-avatar">
                  <img
                    *ngIf="employee.imageUrl"
                    [src]="employee.imageUrl"
                    [alt]="employee.firstName + ' ' + employee.lastName"
                    class="avatar-img"
                  />
                  <div *ngIf="!employee.imageUrl" class="avatar-initials">
                    {{ getInitials(employee.firstName, employee.lastName) }}
                  </div>
                </div>
                <div class="employee-info">
                  <h5 class="employee-name">
                    {{ employee.firstName }} {{ employee.lastName }}
                  </h5>
                  <span class="employee-id badge bg-secondary">
                    {{ employee.employeeId || 'N/A' }}
                  </span>
                </div>
              </div>

              <!-- Employee Details -->
              <div class="employee-details">
                <div class="detail-row">
                  <i class="bi bi-envelope"></i>
                  <span>{{ employee.email }}</span>
                </div>
                <div class="detail-row" *ngIf="employee.phone">
                  <i class="bi bi-telephone"></i>
                  <span>{{ employee.phone }}</span>
                </div>
                <div class="detail-row">
                  <i class="bi bi-briefcase"></i>
                  <span>{{ employee.designationTitle || 'No Designation' }}</span>
                </div>
                <div class="detail-row">
                  <i class="bi bi-building"></i>
                  <span>{{ employee.departmentName || 'No Department' }}</span>
                </div>
              </div>

              <!-- Employee Stats -->
              <div class="employee-stats">
                <div class="stat-item">
                  <i class="bi bi-calendar-event"></i>
                  <span class="stat-value">{{ formatDate(employee.hireDate) }}</span>
                </div>
                <div class="stat-item">
                  <i class="bi bi-person-badge"></i>
                  <span class="stat-value">{{ employee.employmentType }}</span>
                </div>
                <div class="stat-item">
                  <span
                    class="badge"
                    [ngClass]="{
                      'bg-success': employee.status === 'ACTIVE',
                      'bg-danger': employee.status === 'TERMINATED',
                      'bg-warning': employee.status === 'ON_LEAVE',
                      'bg-info': employee.status === 'PROBATION',
                      'bg-secondary': employee.status === 'INACTIVE'
                    }"
                  >
                    {{ employee.status }}
                  </span>
                </div>
              </div>

              <!-- Employee Actions -->
              <div class="employee-actions">
                <button
                  type="button"
                  [routerLink]="['/employees', employee.id]"
                  class="btn btn-info btn-sm"
                >
                  <i class="bi bi-eye"></i> View Details
                </button>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="!hasEmployees(state)" class="col-12">
            <div class="empty-state text-center py-5">
              <i class="bi bi-people" style="font-size: 4rem; color: #ccc"></i>
              <h4 class="mt-3">No Employees Found</h4>
              <p class="text-muted">
                Get started by adding your first employee
              </p>
              <button class="btn btn-primary mt-3" (click)="addNewEmployee()">
                <i class="bi bi-plus-circle"></i> Add Employee
              </button>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <nav *ngIf="hasEmployees(state)" aria-label="Page navigation">
          <ul class="pagination justify-content-end">
            <li
              [ngClass]="0 == (currentPage$ | async) ? ' disabled' : ''"
              class="page-item pointer"
            >
              <a
                (click)="goToNextOrPreviousPage('backward', searchForm.value.name)"
                class="page-link"
              >
                &laquo; Prev
              </a>
            </li>
            <li
              *ngFor="
                let pageNumber of getTotalPages(state)
                  | ExtractArrayValue : 'number';
                let i = index
              "
              class="page-item pointer"
            >

              <a
                (click)="goToPage(i, searchForm.value.name)"
                [ngClass]="i == (currentPage$ | async) ? ' active' : ''"
                class="page-link"
              >
                {{ i + 1 }}
              </a>
            </li>
            <li
              [ngClass]="
                getTotalPages(state) - 1 == (currentPage$ | async)
                  ? ' disabled'
                  : ''
              "
              class="page-item pointer"
            >

              <a
                (click)="goToNextOrPreviousPage('forward', searchForm.value.name)"
                class="page-link"
              >
                Next &raquo;
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </section>
  </ng-container>

  <ng-container *ngSwitchCase="DataState.LOADING">
    <div class="d-flex justify-content-center align-items-center" style="min-height: 400px">
      <div class="text-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading employees...</p>
      </div>
    </div>
  </ng-container>

  <ng-container *ngSwitchCase="DataState.ERROR">
    <div class="container mt-5">
      <div class="alert alert-danger" role="alert">
        <h4 class="alert-heading">
          <i class="bi bi-exclamation-triangle-fill"></i> Error Loading Employees
        </h4>
        <p>{{ state.error }}</p>
        <hr />
        <button class="btn btn-primary" (click)="ngOnInit()">
          <i class="bi bi-arrow-clockwise"></i> Retry
        </button>
      </div>
    </div>
  </ng-container>
</ng-container>
